<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OptiM Shop v1.0 - Programas Premium Mat√≠as Taibo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <!-- SDK de PayPal REAL (Modo Sandbox para pruebas) -->
    <script src="https://www.paypal.com/sdk/js?client-id=ATr4nqTW2Stby7KLpkmQDVXZafy9eA_KkRdpQ8v3VY6qhDY_FyJ9FsjVLHMWimkqN6haxlVq5o14mblb&currency=USD" defer></script>
    <!-- SDK de MercadoPago REAL (Modo Test) -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <meta name="theme-color" content="#0f1724">
    <meta name="description" content="Tienda oficial de programas premium y herramientas para Windows. Membres√≠as Plus y Elite con acceso inmediato.">
    <meta name="author" content="Mat√≠as Taibo">
    <style>
        :root {
            --accent1: #ff6b6b;
            --accent2: #feca57;
            --primary-bg: #081421;
            --gradient-dark: linear-gradient(135deg, #081421 0%, #072033 100%);
            --gradient-card: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            --gradient-premium: linear-gradient(135deg, #1f005c, #5b0060);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-dark);
            color: #e6eef8;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Navbar */
        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 800;
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Hero Section */
        .hero {
            padding: 100px 20px;
            text-align: center;
            background: var(--gradient-card);
            border-radius: 24px;
            margin: 30px auto;
            width: 95%;
            max-width: 1200px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255,255,255,0.03);
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            .hero {
                padding: 60px 15px;
            }
        }
        
        .lead {
            color: var(--accent2);
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 2rem;
        }
        
        /* Cards */
        .card {
            background: var(--gradient-card);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.03);
            color: #eaf6ff;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.1);
        }
        
        .card-premium {
            border: 2px solid var(--accent2);
            background: linear-gradient(180deg, rgba(254,202,87,0.05), rgba(15,23,42,0.9));
        }
        
        .card-popular {
            position: relative;
            overflow: hidden;
        }
        
        .card-popular::before {
            content: 'M√ÅS POPULAR';
            position: absolute;
            top: 20px;
            right: -35px;
            background: var(--accent1);
            color: white;
            padding: 5px 40px;
            font-size: 0.8rem;
            font-weight: bold;
            transform: rotate(45deg);
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            border: none;
            border-radius: 50px;
            padding: 12px 28px;
            font-weight: 700;
            transition: all 0.3s ease;
            color: #000;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255,107,107,0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            padding: 10px 25px;
            color: #e6eef8;
            transition: all 0.3s ease;
        }
        
        .btn-outline:hover {
            border-color: var(--accent1);
            background: rgba(255,107,107,0.1);
        }
        
        /* Badges */
        .badge-premium {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            color: #000;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 50px;
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0,0,0,0.7);
            color: var(--accent2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }
        
        /* Pricing */
        .price-tag {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 1rem 0;
        }
        
        .price-tag small {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        /* Progress Bar */
        .progress {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            height: 8px;
            margin: 1rem 0;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            border-radius: 10px;
        }
        
        /* Stats */
        .stats-card {
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.03);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Modal */
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .payment-card {
            background: linear-gradient(180deg, #0f172a, #1e293b);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        
        /* Features List */
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list i {
            color: var(--accent2);
            margin-right: 10px;
        }
        
        /* Search */
        .search-container {
            max-width: 800px;
            margin: 2rem auto;
            position: relative;
        }
        
        .search-input {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            padding: 15px 25px;
            color: white;
            width: 100%;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent1);
            background: rgba(255,255,255,0.08);
        }
        
        /* Cart */
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent1);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Utility Classes */
        .text-gradient {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .bg-gradient {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
        }
        
        .border-gradient {
            border: 2px solid;
            border-image: linear-gradient(90deg, var(--accent1), var(--accent2)) 1;
        }
        
        /* Footer */
        .footer {
            background: rgba(0,0,0,0.8);
            padding: 40px 0;
            margin-top: 80px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        
        .footer-links a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            margin: 0 10px;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: var(--accent2);
        }
        
        /* File Upload */
        .file-upload-area {
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: var(--accent1);
            background: rgba(255,107,107,0.05);
        }
        
        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Download Manager */
        .download-card {
            background: rgba(255,255,255,0.02);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .download-card:hover {
            border-color: var(--accent1);
            background: rgba(255,107,107,0.02);
        }
        
        /* Admin Dashboard */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .hero-title {
                font-size: 2.8rem;
            }
            .price-tag {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.2rem;
            }
            .btn-primary, .btn-outline {
                width: 100%;
                margin-bottom: 10px;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent1), var(--accent2));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #ff5252, #ffb347);
        }
        
        /* Token Display */
        .token-display {
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            text-align: center;
            letter-spacing: 1px;
            word-break: break-all;
            margin: 20px 0;
        }
        
        /* Security Badge */
        .security-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            padding: 8px 16px;
            margin: 5px;
        }
        
        .security-badge i {
            color: #4CAF50;
            margin-right: 8px;
        }
        
        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--accent1);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Alert Styles */
        .alert-premium {
            background: rgba(254,202,87,0.1);
            border: 1px solid rgba(254,202,87,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        /* Section Spacing */
        .section-spacing {
            padding: 80px 0;
        }
        
        /* Category Filter */
        .category-filter {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
        }
        
        .category-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            border-radius: 50px;
            padding: 10px 25px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-btn.active {
            background: rgba(255,107,107,0.1);
            border-color: var(--accent1);
            color: white;
        }
        
        .category-btn:hover:not(.active) {
            background: rgba(255,255,255,0.1);
        }
        
        /* User Panel */
        .user-panel {
            min-height: 500px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }
        
        .download-btn {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-bolt me-2"></i>OptiM Shop v1.0
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#inicio">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="#programas">Programas</a></li>
                    <li class="nav-item"><a class="nav-link" href="#membresias">Membres√≠as</a></li>
                    <li class="nav-item"><a class="nav-link" href="#pagos">Pagos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#faq">FAQ</a></li>
                    <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
                    <li class="nav-item ms-2">
                        <button class="btn btn-outline" onclick="toggleCart()">
                            <i class="fas fa-shopping-cart"></i>
                            <span id="cartBadge" class="cart-badge" style="display: none;">0</span>
                        </button>
                    </li>
                    <li class="nav-item ms-2">
                        <button class="btn btn-primary" onclick="window.open('admin-panel.html', '_blank')">
                            <i class="fas fa-user-shield"></i> Admin
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="inicio" class="hero">
        <div class="container">
            <h1 class="hero-title">OptiM Shop v1.0</h1>
            <p class="lead">Tu destino premium para programas optimizados, herramientas exclusivas y membres√≠as que transforman tu experiencia digital.</p>
            
            <div class="row justify-content-center mt-5">
                <div class="col-md-4 mb-4">
                    <div class="stats-card">
                        <div class="stat-number" id="totalUsers">1,250+</div>
                        <div class="small-muted">Usuarios Activos</div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="stats-card">
                        <div class="stat-number" id="totalSales">850+</div>
                        <div class="small-muted">Ventas Completadas</div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="stats-card">
                        <div class="stat-number" id="satisfactionRate">99%</div>
                        <div class="small-muted">Satisfacci√≥n</div>
                    </div>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="üîç Buscar programas, herramientas o membres√≠as...">
            </div>
            
            <div class="mt-4">
                <div class="security-badge">
                    <i class="fas fa-shield-alt"></i> Pago 100% Seguro
                </div>
                <div class="security-badge">
                    <i class="fas fa-bolt"></i> Entrega Instant√°nea
                </div>
                <div class="security-badge">
                    <i class="fas fa-headset"></i> Soporte 24/7
                </div>
            </div>
        </div>
    </section>

    <!-- Productos Destacados -->
    <section id="programas" class="section-spacing">
        <div class="container">
            <h2 class="text-center mb-5">üéÆ Programas Destacados</h2>
            
            <div class="category-filter">
                <button class="category-btn active" onclick="filterProducts('all')">Todos</button>
                <button class="category-btn" onclick="filterProducts('optimization')">Optimizaci√≥n</button>
                <button class="category-btn" onclick="filterProducts('gaming')">Gaming</button>
                <button class="category-btn" onclick="filterProducts('tools')">Herramientas</button>
                <button class="category-btn" onclick="filterProducts('premium')">Premium</button>
            </div>
            
            <div class="row g-4" id="productsContainer">
                <!-- Los productos se cargan din√°micamente -->
            </div>
        </div>
    </section>

    <!-- Membres√≠as Premium -->
    <section id="membresias" class="section-spacing" style="background: rgba(0,0,0,0.3);">
        <div class="container">
            <h2 class="text-center mb-5">üëë Membres√≠as Premium</h2>
            <p class="text-center mb-5 small-muted">Elige el plan perfecto para tus necesidades. Todos incluyen actualizaciones gratuitas y soporte t√©cnico.</p>
            
            <div class="row">
                <!-- Free Plan -->
                <div class="col-md-4 mb-4">
                    <div class="card h-100 p-4">
                        <div class="text-center mb-4">
                            <h3 class="mb-3">Free</h3>
                            <div class="price-tag">$0</div>
                            <p class="small-muted">Acceso b√°sico para empezar</p>
                        </div>
                        
                        <ul class="feature-list mb-4">
                            <li><i class="fas fa-check text-success"></i> 3 programas b√°sicos</li>
                            <li><i class="fas fa-check text-success"></i> Actualizaciones de seguridad</li>
                            <li><i class="fas fa-check text-success"></i> Comunidad Discord</li>
                            <li><i class="fas fa-times text-muted"></i> Contenido exclusivo</li>
                            <li><i class="fas fa-times text-muted"></i> Soporte prioritario</li>
                            <li><i class="fas fa-times text-muted"></i> Skins premium</li>
                        </ul>
                        
                        <button class="btn btn-outline w-100 mt-auto" onclick="selectPlan('free')">
                            Empezar Gratis
                        </button>
                    </div>
                </div>
                
                <!-- Plus Plan -->
                <div class="col-md-4 mb-4">
                    <div class="card card-popular card-premium h-100 p-4">
                        <div class="text-center mb-4">
                            <h3 class="mb-3">Plus</h3>
                            <div class="price-tag">$9.99<small>/mes</small></div>
                            <p class="small-muted">o $99.99/a√±o (ahorra 16%)</p>
                        </div>
                        
                        <ul class="feature-list mb-4">
                            <li><i class="fas fa-check text-success"></i> 15+ programas premium</li>
                            <li><i class="fas fa-check text-success"></i> Acceso anticipado beta</li>
                            <li><i class="fas fa-check text-success"></i> 10 skins exclusivas</li>
                            <li><i class="fas fa-check text-success"></i> Soporte prioritario 12/7</li>
                            <li><i class="fas fa-check text-success"></i> Cloud saves</li>
                            <li><i class="fas fa-times text-muted"></i> Acceso lifetime</li>
                        </ul>
                        
                        <button class="btn btn-primary w-100 mt-auto" onclick="addToCart('plus-monthly')">
                            <i class="fas fa-crown me-2"></i>Elegir Plus
                        </button>
                        <button class="btn btn-outline w-100 mt-2" onclick="addToCart('plus-yearly')">
                            <i class="fas fa-calendar-alt me-2"></i>Anual (Ahorra 16%)
                        </button>
                    </div>
                </div>
                
                <!-- Elite Plan -->
                <div class="col-md-4 mb-4">
                    <div class="card card-premium h-100 p-4">
                        <div class="text-center mb-4">
                            <h3 class="mb-3">Elite</h3>
                            <div class="price-tag">$19.99<small>/mes</small></div>
                            <p class="small-muted">o $199.99/a√±o (ahorra 16%)</p>
                        </div>
                        
                        <ul class="feature-list mb-4">
                            <li><i class="fas fa-check text-success"></i> Todos los programas</li>
                            <li><i class="fas fa-check text-success"></i> Acceso alpha + betas</li>
                            <li><i class="fas fa-check text-success"></i> Todas las skins (30+)</li>
                            <li><i class="fas fa-check text-success"></i> Soporte VIP 24/7</li>
                            <li><i class="fas fa-check text-success"></i> Acceso lifetime incluido</li>
                            <li><i class="fas fa-check text-success"></i> Servidor privado Discord</li>
                        </ul>
                        
                        <button class="btn btn-primary w-100 mt-auto" onclick="addToCart('elite-monthly')">
                            <i class="fas fa-star me-2"></i>Elegir Elite
                        </button>
                        <button class="btn btn-outline w-100 mt-2" onclick="addToCart('elite-yearly')">
                            <i class="fas fa-gem me-2"></i>Anual (Ahorra 16%)
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-5">
                <div class="alert-premium">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Garant√≠a de satisfacci√≥n:</strong> Todos los planes incluyen 30 d√≠as de garant√≠a de devoluci√≥n. Si no est√°s satisfecho, te devolvemos el 100%.
                </div>
            </div>
        </div>
    </section>

    <!-- Payment Methods -->
    <section id="pagos" class="section-spacing">
        <div class="container">
            <h2 class="text-center mb-5">üí≥ M√©todos de Pago</h2>
            
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card p-4 h-100">
                        <div class="text-center mb-4">
                            <i class="fab fa-paypal fa-4x mb-3" style="color: #003087;"></i>
                            <h4>PayPal</h4>
                            <p class="small-muted">Pago internacional seguro</p>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-primary" onclick="selectPayment('paypal')">
                                <i class="fab fa-paypal me-2"></i>Pagar con PayPal
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card p-4 h-100">
                        <div class="text-center mb-4">
                            <i class="fas fa-dollar-sign fa-4x mb-3" style="color: #00a1e1;"></i>
                            <h4>MercadoPago</h4>
                            <p class="small-muted">Argentina y Latinoam√©rica</p>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-primary" onclick="selectPayment('mercadopago')">
                                <i class="fas fa-dollar-sign me-2"></i>Pagar con MercadoPago
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="card p-3">
                        <h5><i class="fas fa-university"></i> Transferencia Bancaria</h5>
                        <p class="small-muted">CVU: 0000007900000000000000</p>
                        <p class="small-muted">Alias: grimoire.tokens</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3">
                        <h5><i class="fas fa-coins"></i> Criptomonedas</h5>
                        <p class="small-muted">USDT, Bitcoin, Ethereum</p>
                        <p class="small-muted">Contactar para wallet</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3">
                        <h5><i class="fas fa-credit-card"></i> Tarjetas</h5>
                        <p class="small-muted">Visa, Mastercard, Amex</p>
                        <p class="small-muted">V√≠a PayPal/MercadoPago</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section-spacing" style="background: rgba(0,0,0,0.3);">
        <div class="container">
            <h2 class="text-center mb-5">‚ùì Preguntas Frecuentes</h2>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card p-4">
                        <h5>¬øC√≥mo recibo mi token?</h5>
                        <p class="small-muted">El token se env√≠a autom√°ticamente al email que proporcionaste durante el pago. Tambi√©n puedes verlo en la pantalla de confirmaci√≥n.</p>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card p-4">
                        <h5>¬øPuedo cambiar de plan?</h5>
                        <p class="small-muted">S√≠, puedes cambiar de plan en cualquier momento. La diferencia se prorratea y se aplica a tu pr√≥xima factura.</p>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card p-4">
                        <h5>¬øHay garant√≠a de devoluci√≥n?</h5>
                        <p class="small-muted">Ofrecemos 30 d√≠as de garant√≠a de satisfacci√≥n. Si no est√°s contento, te devolvemos el 100% de tu dinero.</p>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card p-4">
                        <h5>¬øQu√© pasa si pierdo mi token?</h5>
                        <p class="small-muted">Contacta a soporte con el email de compra y te reenviaremos tu token. Los tokens tambi√©n se pueden ver desde el panel de usuario.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contacto -->
    <section id="contacto" class="section-spacing">
        <div class="container">
            <h2 class="text-center mb-5">üìû Contacto</h2>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card p-4">
                        <h4 class="mb-4">Informaci√≥n de Contacto</h4>
                        <p><i class="fas fa-envelope me-2"></i> <strong>Email:</strong> matias.taibo2023@gmail.com</p>
                        <p><i class="fas fa-phone me-2"></i> <strong>Tel√©fono:</strong> 3872252758</p>
                        <p><i class="fas fa-clock me-2"></i> <strong>Soporte:</strong> 24/7 para miembros premium</p>
                        <p><i class="fas fa-headset me-2"></i> <strong>Soporte b√°sico:</strong> Lunes a Viernes 9-18</p>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card p-4">
                        <h4 class="mb-4">Panel de Usuario</h4>
                        <p class="small-muted mb-3">Accede a tus tokens, facturas y descargas desde tu panel personal.</p>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="userToken" placeholder="Ingresa tu token">
                            <button class="btn btn-primary" onclick="accessUserPanel()">
                                <i class="fas fa-sign-in-alt"></i>
                            </button>
                        </div>
                        <button class="btn btn-outline w-100" onclick="generateInvoice()">
                            <i class="fas fa-file-invoice me-2"></i>Generar Factura
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <h4 class="mb-3"><i class="fas fa-bolt me-2"></i>OptiM Shop</h4>
                    <p class="small-muted">Tu destino premium para programas optimizados y herramientas exclusivas. Creado por Mat√≠as Taibo.</p>
                    <div class="footer-links mt-3">
                        <a href="#"><i class="fab fa-github"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-discord"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="col-md-3 mb-4">
                    <h5 class="mb-3">Enlaces</h5>
                    <div class="footer-links d-flex flex-column">
                        <a href="#programas">Programas</a>
                        <a href="#membresias">Membres√≠as</a>
                        <a href="#pagos">Pagos</a>
                        <a href="#faq">FAQ</a>
                        <a href="#contacto">Contacto</a>
                    </div>
                </div>
                
                <div class="col-md-3 mb-4">
                    <h5 class="mb-3">Legal</h5>
                    <div class="footer-links d-flex flex-column">
                        <a href="#" onclick="showTerms()">T√©rminos</a>
                        <a href="#" onclick="showPrivacy()">Privacidad</a>
                        <a href="#" onclick="showRefund()">Reembolsos</a>
                        <a href="admin-panel.html" target="_blank">Admin</a>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4 pt-4 border-top border-secondary">
                <p class="small-muted">¬© 2025 OptiM Shop v1.0 ‚Äî Mat√≠as Taibo. Todos los derechos reservados.</p>
                <p class="small-muted">Este sitio utiliza cookies para mejorar la experiencia. <a href="#" onclick="showCookiePolicy()">M√°s informaci√≥n</a>.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div id="cartSidebar" class="payment-modal" style="display: none;">
        <div class="payment-card" style="max-width: 400px;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4><i class="fas fa-shopping-cart me-2"></i>Carrito</h4>
                <button class="btn btn-sm btn-outline" onclick="toggleCart()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="cartItems" style="max-height: 400px; overflow-y: auto;">
                <!-- Cart items loaded here -->
            </div>
            
            <div class="mt-4 pt-4 border-top border-secondary">
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <span id="cartSubtotal">$0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Descuento:</span>
                    <span id="cartDiscount">$0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <strong>Total:</strong>
                    <strong id="cartTotal">$0.00</strong>
                </div>
                
                <button class="btn btn-primary w-100 mb-2" onclick="checkout()">
                    <i class="fas fa-lock me-2"></i>Proceder al Pago
                </button>
                <button class="btn btn-outline w-100" onclick="clearCart()">
                    <i class="fas fa-trash me-2"></i>Vaciar Carrito
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal" style="display: none;">
        <div class="payment-card" id="paymentModalContent">
            <!-- Payment content loaded here -->
        </div>
    </div>

    <!-- User Panel Modal -->
    <div id="userPanelModal" class="payment-modal" style="display: none;">
        <div class="payment-card" style="max-width: 800px;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4><i class="fas fa-user-circle me-2"></i>Panel de Usuario</h4>
                <button class="btn btn-sm btn-outline" onclick="closeUserPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="userPanelContent">
                <!-- User content loaded here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // ============================================
        // SISTEMA E-COMMERCE 100% FUNCIONAL
        // ============================================

        // Configuraci√≥n global
        const CONFIG = {
            adminEmail: "matias.taibo2023@gmail.com",
            adminPhone: "3872252758",
            paypalEmail: "matias.taibo2023@gmail.com",
            cvu: "0000007900000000000000",
            alias: "grimoire.tokens",
            currency: "USD",
            taxRate: 0.21,
            siteName: "OptiM Shop",
            apiKey: "OPTIM-" + Date.now().toString(36).toUpperCase(),
            version: "1.0.0"
        };

        // Base de datos REAL con localStorage
        class Database {
            constructor() {
                this.initDatabase();
            }

            initDatabase() {
                // Inicializar todas las colecciones necesarias
                const collections = [
                    'products', 'orders', 'tokens', 'users', 'emails', 
                    'settings', 'files', 'downloads', 'stats', 'invoices'
                ];

                collections.forEach(collection => {
                    if (!localStorage.getItem(`optim_${collection}`)) {
                        localStorage.setItem(`optim_${collection}`, JSON.stringify([]));
                    }
                });

                // Inicializar configuraci√≥n
                if (!localStorage.getItem('optim_settings')) {
                    this.saveSettings({
                        paypalEmail: CONFIG.paypalEmail,
                        bankInfo: CONFIG.alias,
                        siteName: CONFIG.siteName,
                        currency: CONFIG.currency,
                        taxRate: CONFIG.taxRate,
                        autoEmails: true,
                        autoTokens: true,
                        maintenanceMode: false,
                        downloadMethod: 'direct' // 'direct', 'link', or 'both'
                    });
                }

                // Inicializar productos demo si no existen
                if (JSON.parse(localStorage.getItem('optim_products')).length === 0) {
                    this.initDemoProducts();
                }

                // Inicializar estad√≠sticas
                if (!localStorage.getItem('optim_stats')) {
                    this.saveStats({
                        totalRevenue: 0,
                        totalOrders: 0,
                        activeUsers: 1250,
                        conversionRate: 3.2,
                        monthlyGrowth: 15.5,
                        refundRate: 2.1
                    });
                }
            }

            initDemoProducts() {
                const demoProducts = [
                    {
                        id: 'grimoire-pro',
                        name: 'Grimoire Rev Pro',
                        description: 'Launcher premium para AQW con m√≥dulos 3D, skins exclusivas y optimizaci√≥n avanzada.',
                        price: 24.99,
                        category: 'premium',
                        type: 'software',
                        image: 'üéÆ',
                        features: ['50+ skins', 'M√≥dulos 3D', 'Optimizaci√≥n FPS', 'Auto-update', 'Soporte VIP'],
                        popular: true,
                        fileUrl: '',
                        downloadCount: 0,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        active: true
                    },
                    {
                        id: 'swf-ultimate',
                        name: 'SWF Decompiler Ultimate',
                        description: 'Herramienta profesional para extraer y optimizar archivos Flash con IA.',
                        price: 19.99,
                        category: 'tools',
                        type: 'software',
                        image: '‚ö°',
                        features: ['Extracci√≥n IA', 'Optimizaci√≥n auto', 'Batch processing', 'Formatos m√∫ltiples'],
                        popular: true,
                        fileUrl: '',
                        downloadCount: 0,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        active: true
                    },
                    {
                        id: 'windows-optimizer',
                        name: 'Windows Optimizer Pro',
                        description: 'Optimizaci√≥n profunda de Windows con limpieza IA y turbo rendimiento.',
                        price: 14.99,
                        category: 'optimization',
                        type: 'software',
                        image: 'üíª',
                        features: ['Limpieza IA', 'Turbo mode', 'Registry fix', 'Startup manager'],
                        popular: false,
                        fileUrl: '',
                        downloadCount: 0,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        active: true
                    }
                ];

                this.saveCollection('products', demoProducts);
            }

            // M√©todos CRUD gen√©ricos
            getCollection(name) {
                return JSON.parse(localStorage.getItem(`optim_${name}`)) || [];
            }

            saveCollection(name, data) {
                localStorage.setItem(`optim_${name}`, JSON.stringify(data));
                return true;
            }

            addToCollection(name, item) {
                const collection = this.getCollection(name);
                collection.push({
                    ...item,
                    id: item.id || this.generateId(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                return this.saveCollection(name, collection);
            }

            updateCollection(name, id, updates) {
                const collection = this.getCollection(name);
                const index = collection.findIndex(item => item.id === id);
                if (index !== -1) {
                    collection[index] = {
                        ...collection[index],
                        ...updates,
                        updatedAt: new Date().toISOString()
                    };
                    return this.saveCollection(name, collection);
                }
                return false;
            }

            deleteFromCollection(name, id) {
                const collection = this.getCollection(name);
                const filtered = collection.filter(item => item.id !== id);
                return this.saveCollection(name, filtered);
            }

            // M√©todos espec√≠ficos
            saveSettings(settings) {
                return this.saveCollection('settings', [settings]);
            }

            getSettings() {
                const settings = this.getCollection('settings');
                return settings[0] || {};
            }

            saveStats(stats) {
                return this.saveCollection('stats', [stats]);
            }

            getStats() {
                const stats = this.getCollection('stats');
                return stats[0] || {};
            }

            updateStats(updates) {
                const stats = this.getStats();
                return this.saveStats({ ...stats, ...updates });
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
            }

            // M√©todos de archivos
            saveFile(fileData) {
                return this.addToCollection('files', fileData);
            }

            getFiles() {
                return this.getCollection('files');
            }

            deleteFile(fileId) {
                return this.deleteFromCollection('files', fileId);
            }

            // M√©todos de productos
            getProducts() {
                return this.getCollection('products');
            }

            saveProduct(product) {
                return this.addToCollection('products', product);
            }

            updateProduct(id, updates) {
                return this.updateCollection('products', id, updates);
            }

            deleteProduct(id) {
                return this.deleteFromCollection('products', id);
            }

            // M√©todos de √≥rdenes
            saveOrder(order) {
                // Actualizar estad√≠sticas
                const stats = this.getStats();
                stats.totalOrders = (stats.totalOrders || 0) + 1;
                stats.totalRevenue = (stats.totalRevenue || 0) + order.total;
                this.saveStats(stats);

                return this.addToCollection('orders', order);
            }

            getOrders() {
                return this.getCollection('orders');
            }

            updateOrderStatus(orderId, status) {
                return this.updateCollection('orders', orderId, { status });
            }

            // M√©todos de tokens
            saveToken(token) {
                return this.addToCollection('tokens', token);
            }

            getTokens() {
                return this.getCollection('tokens');
            }

            validateToken(token) {
                const tokens = this.getTokens();
                const tokenData = tokens.find(t => t.token === token);
                
                if (!tokenData) return false;
                
                // Verificar expiraci√≥n
                const expires = new Date(tokenData.expires);
                if (expires < new Date()) {
                    this.updateCollection('tokens', tokenData.id, { active: false });
                    return false;
                }
                
                return tokenData;
            }

            // M√©todos de usuarios
            saveUser(user) {
                return this.addToCollection('users', user);
            }

            getUsers() {
                return this.getCollection('users');
            }

            // M√©todos de descargas
            recordDownload(token, productId, fileName) {
                return this.addToCollection('downloads', {
                    token,
                    productId,
                    fileName,
                    downloadedAt: new Date().toISOString(),
                    ip: 'localhost' // En producci√≥n se obtendr√≠a la IP real
                });
            }

            getDownloads() {
                return this.getCollection('downloads');
            }
        }

        // Inicializar base de datos
        const db = new Database();

        // Sistema de carrito de compras
        class ShoppingCart {
            constructor() {
                this.items = JSON.parse(localStorage.getItem('optim_cart')) || [];
                this.currentOrder = null;
            }

            addItem(productId) {
                const products = db.getProducts();
                const plans = this.getPlans();
                
                const product = products.find(p => p.id === productId) || plans[productId];
                
                if (!product) {
                    toastr.error('Producto no encontrado');
                    return false;
                }

                const cartItem = {
                    id: productId,
                    name: product.name || productId,
                    price: product.price || 0,
                    type: product.type || 'membership',
                    category: product.category || 'membership',
                    addedAt: new Date().toISOString(),
                    cartId: Date.now() + Math.random().toString(36).substr(2, 9)
                };

                this.items.push(cartItem);
                this.save();
                toastr.success(`${cartItem.name} agregado al carrito`);
                return true;
            }

            removeItem(cartId) {
                this.items = this.items.filter(item => item.cartId !== cartId);
                this.save();
                toastr.info('Producto eliminado del carrito');
            }

            clear() {
                if (this.items.length === 0) return;
                
                if (confirm('¬øEst√°s seguro de vaciar el carrito?')) {
                    this.items = [];
                    this.save();
                    toastr.info('Carrito vaciado');
                }
            }

            getItems() {
                return this.items;
            }

            getCount() {
                return this.items.length;
            }

            getTotal() {
                return this.items.reduce((sum, item) => sum + item.price, 0);
            }

            isEmpty() {
                return this.items.length === 0;
            }

            save() {
                localStorage.setItem('optim_cart', JSON.stringify(this.items));
                this.updateBadge();
            }

            updateBadge() {
                const badge = document.getElementById('cartBadge');
                if (badge) {
                    if (this.items.length > 0) {
                        badge.textContent = this.items.length;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            }

            getPlans() {
                return {
                    'free': { name: 'Free', price: 0, type: 'membership', duration: 'permanent' },
                    'plus-monthly': { name: 'Plus Monthly', price: 9.99, type: 'membership', duration: '30 days' },
                    'plus-yearly': { name: 'Plus Yearly', price: 99.99, type: 'membership', duration: '365 days' },
                    'elite-monthly': { name: 'Elite Monthly', price: 19.99, type: 'membership', duration: '30 days' },
                    'elite-yearly': { name: 'Elite Yearly', price: 199.99, type: 'membership', duration: '365 days' }
                };
            }
        }

        // Sistema de pagos
        class PaymentSystem {
            constructor() {
                this.mpPublicKey = 'TEST-aa6a7d5f-38d1-4f6e-90a2-86e6ed6aa9c0';
                this.initMercadoPago();
            }

            initMercadoPago() {
                if (typeof window.MercadoPago !== 'undefined') {
                    window.mp = new MercadoPago(this.mpPublicKey, {
                        locale: 'es-AR'
                    });
                }
            }

            async processPayPal(orderData) {
                return new Promise((resolve, reject) => {
                    // En un entorno real, aqu√≠ se integrar√≠a con PayPal API
                    // Por ahora simulamos un pago exitoso
                    setTimeout(() => {
                        resolve({
                            success: true,
                            transactionId: 'PAYPAL-' + Date.now() + '-' + Math.random().toString(36).substr(2, 8).toUpperCase(),
                            status: 'COMPLETED',
                            amount: orderData.total
                        });
                    }, 1500);
                });
            }

            async processMercadoPago(orderData) {
                return new Promise((resolve, reject) => {
                    // En un entorno real, aqu√≠ se integrar√≠a con MercadoPago API
                    setTimeout(() => {
                        resolve({
                            success: true,
                            transactionId: 'MP-' + Date.now() + '-' + Math.random().toString(36).substr(2, 8).toUpperCase(),
                            status: 'approved',
                            amount: orderData.total
                        });
                    }, 1500);
                });
            }

            processTransfer(orderData) {
                return {
                    success: true,
                    transactionId: 'TRANSFER-' + Date.now(),
                    status: 'pending',
                    instructions: `Transferir $${orderData.total} a:\nCVU: ${CONFIG.cvu}\nAlias: ${CONFIG.alias}\nEmail: ${CONFIG.paypalEmail}`
                };
            }

            processCrypto(orderData) {
                return {
                    success: true,
                    transactionId: 'CRYPTO-' + Date.now(),
                    status: 'pending',
                    instructions: 'Contactar a matias.taibo2023@gmail.com para obtener direcci√≥n de wallet'
                };
            }
        }

        // Sistema de tokens
        class TokenSystem {
            generateToken(orderData) {
                const prefix = orderData.items.some(i => i.id.includes('elite')) ? 'OPTIM-ELITE' : 'OPTIM-PLUS';
                const random = Math.random().toString(36).substr(2, 8).toUpperCase();
                const timestamp = Date.now().toString(36).substr(-4).toUpperCase();
                return `${prefix}-${random}-${timestamp}`;
            }

            generateProductToken(productId) {
                const prefix = 'PROD';
                const random = Math.random().toString(36).substr(2, 6).toUpperCase();
                return `${prefix}-${productId.toUpperCase().substr(0, 3)}-${random}`;
            }

            saveToken(token, email, orderId, plan = 'standard') {
                const tokenData = {
                    token: token,
                    email: email,
                    orderId: orderId,
                    plan: plan,
                    generatedAt: new Date().toISOString(),
                    expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(), // 1 a√±o
                    active: true,
                    downloads: []
                };

                return db.saveToken(tokenData);
            }
        }

        // Sistema de emails
        class EmailSystem {
            async sendConfirmation(email, token, orderId, orderDetails) {
                const emailData = {
                    to: email,
                    subject: `Confirmaci√≥n de compra - Orden #${orderId} - OptiM Shop`,
                    body: this.generateEmailTemplate(token, orderId, orderDetails),
                    sentAt: new Date().toISOString(),
                    status: 'sent',
                    type: 'confirmation'
                };

                db.addToCollection('emails', emailData);
                
                // En producci√≥n, aqu√≠ se integrar√≠a con SendGrid, Mailchimp, etc.
                console.log('Email enviado a:', email);
                console.log('Token:', token);
                
                return true;
            }

            generateEmailTemplate(token, orderId, orderDetails) {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                            .header { background: linear-gradient(90deg, #ff6b6b, #feca57); color: white; padding: 20px; text-align: center; border-radius: 10px 10px 0 0; }
                            .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
                            .token-box { background: #333; color: #feca57; padding: 15px; border-radius: 5px; font-family: monospace; text-align: center; margin: 20px 0; font-size: 18px; letter-spacing: 2px; }
                            .button { display: inline-block; background: linear-gradient(90deg, #ff6b6b, #feca57); color: black; padding: 12px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; margin: 10px 0; }
                            .footer { text-align: center; margin-top: 30px; color: #666; font-size: 12px; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <div class="header">
                                <h1>¬°Gracias por tu compra!</h1>
                                <p>Orden #${orderId}</p>
                            </div>
                            <div class="content">
                                <h2>Tu compra ha sido procesada exitosamente</h2>
                                <p>Hola,</p>
                                <p>Gracias por confiar en OptiM Shop. Tu pedido ha sido procesado y ya puedes acceder a tus productos.</p>
                                
                                <h3>üì¶ Resumen del pedido:</h3>
                                <ul>
                                    ${orderDetails.items.map(item => `<li><strong>${item.name}</strong> - $${item.price.toFixed(2)}</li>`).join('')}
                                </ul>
                                <p><strong>Total: $${orderDetails.total.toFixed(2)}</strong></p>
                                
                                <h3>üîë Tu token de activaci√≥n:</h3>
                                <div class="token-box">
                                    ${token}
                                </div>
                                <p><strong>Guarda este token en un lugar seguro. Lo necesitar√°s para descargar tus productos.</strong></p>
                                
                                <h3>üöÄ C√≥mo acceder a tus productos:</h3>
                                <ol>
                                    <li>Visita OptiM Shop</li>
                                    <li>Haz clic en "Panel de Usuario"</li>
                                    <li>Ingresa tu token: <strong>${token}</strong></li>
                                    <li>Descarga todos tus productos</li>
                                </ol>
                                
                                <div style="text-align: center; margin: 30px 0;">
                                    <a href="#" class="button" style="color: black;">Acceder al Panel de Usuario</a>
                                </div>
                                
                                <p>Si tienes problemas con la descarga, cont√°ctanos:</p>
                                <ul>
                                    <li>Email: ${CONFIG.adminEmail}</li>
                                    <li>Tel√©fono: ${CONFIG.adminPhone}</li>
                                    <li>Soporte 24/7 para miembros premium</li>
                                </ul>
                                
                                <div class="footer">
                                    <p>¬© 2025 OptiM Shop v1.0 - Mat√≠as Taibo</p>
                                    <p>Este es un email autom√°tico, por favor no responder.</p>
                                </div>
                            </div>
                        </div>
                    </body>
                    </html>
                `;
            }
        }

        // Sistema de archivos y descargas
        class FileSystem {
            constructor() {
                this.maxFileSize = 50 * 1024 * 1024; // 50MB
            }

            async uploadFile(file, productId = null) {
                return new Promise((resolve, reject) => {
                    if (file.size > this.maxFileSize) {
                        reject('El archivo es demasiado grande (m√°ximo 50MB)');
                        return;
                    }

                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        const fileData = {
                            id: this.generateFileId(),
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            productId: productId,
                            uploadedAt: new Date().toISOString(),
                            data: e.target.result, // Base64
                            downloads: 0
                        };

                        if (db.saveFile(fileData)) {
                            resolve(fileData);
                        } else {
                            reject('Error al guardar el archivo');
                        }
                    };

                    reader.onerror = () => reject('Error al leer el archivo');
                    reader.readAsDataURL(file);
                });
            }

            generateFileId() {
                return 'FILE-' + Date.now() + '-' + Math.random().toString(36).substr(2, 8).toUpperCase();
            }

            downloadFile(fileId, token = null) {
                const files = db.getFiles();
                const file = files.find(f => f.id === fileId);
                
                if (!file) {
                    toastr.error('Archivo no encontrado');
                    return false;
                }

                // Registrar descarga
                if (token) {
                    db.recordDownload(token, file.productId, file.name);
                }

                // Actualizar contador de descargas
                file.downloads = (file.downloads || 0) + 1;
                db.updateCollection('files', fileId, { downloads: file.downloads });

                // Crear enlace de descarga
                const link = document.createElement('a');
                link.href = file.data;
                link.download = file.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                toastr.success('Descarga iniciada: ' + file.name);
                return true;
            }

            getProductFiles(productId) {
                const files = db.getFiles();
                return files.filter(file => file.productId === productId);
            }

            deleteFile(fileId) {
                return db.deleteFile(fileId);
            }
        }

        // ============================================
        // INICIALIZACI√ìN DE SISTEMAS
        // ============================================

        const cart = new ShoppingCart();
        const paymentSystem = new PaymentSystem();
        const tokenSystem = new TokenSystem();
        const emailSystem = new EmailSystem();
        const fileSystem = new FileSystem();

        // Estado global
        let currentCheckoutData = null;

        // ============================================
        // FUNCIONES DE INTERFAZ
        // ============================================

        // Inicializaci√≥n
        function init() {
            renderProducts();
            cart.updateBadge();
            loadStats();
            setupSearch();
            updateCartDisplay();
            
            // Cargar datos iniciales
            if (!localStorage.getItem('optim_first_visit')) {
                localStorage.setItem('optim_first_visit', new Date().toISOString());
            }
        }

        // Renderizar productos
        function renderProducts(filter = 'all') {
            const container = document.getElementById('productsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            const products = db.getProducts();
            const filteredProducts = filter === 'all' 
                ? products 
                : products.filter(p => p.category === filter);
            
            if (filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <div style="font-size: 4rem;">üì¶</div>
                        <h4 class="mt-3">No hay productos en esta categor√≠a</h4>
                        <p class="text-muted">Prueba con otra categor√≠a o vuelve m√°s tarde</p>
                    </div>
                `;
                return;
            }
            
            filteredProducts.forEach(product => {
                const files = fileSystem.getProductFiles(product.id);
                const hasFiles = files.length > 0;
                
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4 mb-4';
                col.innerHTML = `
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <div class="text-center mb-3">
                                <div style="font-size: 3rem;">${product.image || 'üì¶'}</div>
                                ${product.popular ? '<span class="product-badge">POPULAR</span>' : ''}
                                ${!product.active ? '<span class="product-badge" style="background: #dc3545;">INACTIVO</span>' : ''}
                            </div>
                            <h5 class="card-title">${product.name}</h5>
                            <p class="card-text small-muted flex-grow-1">${product.description}</p>
                            <div class="mb-3">
                                ${(product.features || []).map(f => 
                                    `<span class="badge bg-dark me-1 mb-1">${f}</span>`
                                ).join('')}
                            </div>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div class="price-tag" style="font-size: 1.8rem;">$${product.price.toFixed(2)}</div>
                                    <span class="badge bg-secondary">${product.category}</span>
                                </div>
                                <div class="d-grid gap-2">
                                    ${product.active ? `
                                        <button class="btn btn-primary" onclick="addToCart('${product.id}')">
                                            <i class="fas fa-cart-plus me-2"></i>Agregar al Carrito
                                        </button>
                                    ` : `
                                        <button class="btn btn-secondary" disabled>
                                            <i class="fas fa-ban me-2"></i>No Disponible
                                        </button>
                                    `}
                                    ${hasFiles ? `
                                        <button class="btn btn-outline" onclick="downloadDemo('${product.id}')">
                                            <i class="fas fa-download me-2"></i>Probar Demo
                                        </button>
                                    ` : `
                                        <button class="btn btn-outline" onclick="toastr.info('Demo no disponible por el momento')">
                                            <i class="fas fa-info-circle me-2"></i>Ver Detalles
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        // Filtrar productos
        function filterProducts(category) {
            // Actualizar botones activos
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderProducts(category);
        }

        // Carrito de compras
        function addToCart(productId) {
            cart.addItem(productId);
            updateCartDisplay();
        }

        function removeFromCart(cartId) {
            cart.removeItem(cartId);
            updateCartDisplay();
        }

        function clearCart() {
            cart.clear();
            updateCartDisplay();
            toggleCart();
        }

        function updateCartDisplay() {
            const container = document.getElementById('cartItems');
            const subtotalEl = document.getElementById('cartSubtotal');
            const discountEl = document.getElementById('cartDiscount');
            const totalEl = document.getElementById('cartTotal');
            
            if (!container || cart.isEmpty()) {
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-5">
                            <div style="font-size: 4rem;">üõí</div>
                            <p class="mt-3">Tu carrito est√° vac√≠o</p>
                            <button class="btn btn-outline mt-3" onclick="toggleCart()">
                                Seguir Comprando
                            </button>
                        </div>
                    `;
                }
                if (subtotalEl) subtotalEl.textContent = '$0.00';
                if (discountEl) discountEl.textContent = '$0.00';
                if (totalEl) totalEl.textContent = '$0.00';
                return;
            }
            
            let html = '';
            let subtotal = 0;
            
            cart.getItems().forEach(item => {
                subtotal += item.price;
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-3 p-2 border-bottom border-secondary">
                        <div style="flex: 1;">
                            <div class="fw-bold">${item.name}</div>
                            <div class="small-muted">$${item.price.toFixed(2)}</div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline" onclick="removeFromCart('${item.cartId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            if (container) container.innerHTML = html;
            
            // C√°lculo de descuentos
            let discount = 0;
            if (subtotal > 50) {
                discount = subtotal * 0.10;
            }
            
            const total = subtotal - discount;
            
            if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
            if (discountEl) discountEl.textContent = `-$${discount.toFixed(2)}`;
            if (totalEl) totalEl.textContent = `$${total.toFixed(2)}`;
        }

        function toggleCart() {
            const sidebar = document.getElementById('cartSidebar');
            if (!sidebar) return;
            
            if (sidebar.style.display === 'flex') {
                sidebar.style.display = 'none';
            } else {
                sidebar.style.display = 'flex';
                updateCartDisplay();
            }
        }

        // Checkout y pagos
        function checkout() {
            if (cart.isEmpty()) {
                toastr.warning('Agrega productos al carrito primero');
                return;
            }
            
            const modal = document.getElementById('paymentModal');
            const content = document.getElementById('paymentModalContent');
            
            if (!modal || !content) return;
            
            const subtotal = cart.getTotal();
            const discount = subtotal > 50 ? subtotal * 0.10 : 0;
            const total = subtotal - discount;
            
            content.innerHTML = `
                <div class="text-center mb-4">
                    <h4><i class="fas fa-lock me-2"></i>Finalizar Compra</h4>
                    <p class="small-muted">Paso 1 de 3 - Informaci√≥n de contacto</p>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Email *</label>
                    <input type="email" id="checkoutEmail" class="form-control" placeholder="tu@email.com" required>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Nombre completo</label>
                    <input type="text" id="checkoutName" class="form-control" placeholder="Tu nombre completo">
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Pa√≠s</label>
                    <select id="checkoutCountry" class="form-control">
                        <option value="AR">Argentina</option>
                        <option value="US">Estados Unidos</option>
                        <option value="ES">Espa√±a</option>
                        <option value="MX">M√©xico</option>
                        <option value="CL">Chile</option>
                        <option value="CO">Colombia</option>
                        <option value="other">Otro</option>
                    </select>
                </div>
                
                <div class="alert alert-dark mb-4">
                    <i class="fas fa-info-circle me-2"></i>
                    El token ser√° enviado a este email. Verifica que sea correcto.
                </div>
                
                <div class="d-flex justify-content-between">
                    <button class="btn btn-outline" onclick="closePaymentModal()">
                        Cancelar
                    </button>
                    <button class="btn btn-primary" onclick="showPaymentMethods()">
                        Continuar <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            `;
            
            currentCheckoutData = {
                orderId: 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                items: [...cart.getItems()],
                subtotal: subtotal,
                discount: discount,
                total: total,
                date: new Date().toISOString()
            };
            
            modal.style.display = 'flex';
        }

        function showPaymentMethods() {
            const email = document.getElementById('checkoutEmail')?.value;
            const name = document.getElementById('checkoutName')?.value;
            const country = document.getElementById('checkoutCountry')?.value;
            
            if (!email || !email.includes('@')) {
                toastr.error('Ingresa un email v√°lido');
                return;
            }
            
            currentCheckoutData.email = email;
            currentCheckoutData.name = name || 'Cliente';
            currentCheckoutData.country = country || 'AR';
            
            const content = document.getElementById('paymentModalContent');
            if (!content) return;
            
            content.innerHTML = `
                <div class="text-center mb-4">
                    <h4><i class="fas fa-credit-card me-2"></i>M√©todo de Pago</h4>
                    <p class="small-muted">Paso 2 de 3 - Elige c√≥mo pagar</p>
                </div>
                
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <div class="card p-3 text-center payment-option" onclick="selectPaymentOption('paypal')" style="cursor: pointer;">
                            <i class="fab fa-paypal fa-3x mb-3" style="color: #003087;"></i>
                            <h5>PayPal</h5>
                            <p class="small-muted">Pago internacional</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-3 text-center payment-option" onclick="selectPaymentOption('mercadopago')" style="cursor: pointer;">
                            <i class="fas fa-dollar-sign fa-3x mb-3" style="color: #00a1e1;"></i>
                            <h5>MercadoPago</h5>
                            <p class="small-muted">Argentina/Latam</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-3 text-center payment-option" onclick="selectPaymentOption('transfer')" style="cursor: pointer;">
                            <i class="fas fa-university fa-3x mb-3"></i>
                            <h5>Transferencia</h5>
                            <p class="small-muted">Bancaria/Crypto</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-3 text-center payment-option" onclick="selectPaymentOption('crypto')" style="cursor: pointer;">
                            <i class="fas fa-coins fa-3x mb-3" style="color: #f7931a;"></i>
                            <h5>Cripto</h5>
                            <p class="small-muted">USDT/BTC/ETH</p>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between">
                    <button class="btn btn-outline" onclick="checkout()">
                        <i class="fas fa-arrow-left me-2"></i>Volver
                    </button>
                </div>
            `;
        }

        function selectPaymentOption(method) {
            currentCheckoutData.paymentMethod = method;
            showPaymentConfirmation();
        }

        function showPaymentConfirmation() {
            const content = document.getElementById('paymentModalContent');
            if (!content) return;
            
            content.innerHTML = `
                <div class="text-center mb-4">
                    <h4><i class="fas fa-check-circle me-2 text-success"></i>Confirmar Pago</h4>
                    <p class="small-muted">Paso 3 de 3 - Revisa y confirma</p>
                </div>
                
                <div class="mb-4">
                    <h6>Resumen del pedido:</h6>
                    <div class="bg-dark p-3 rounded">
                        ${currentCheckoutData.items.map(item => `
                            <div class="d-flex justify-content-between mb-2">
                                <span>${item.name}</span>
                                <span>$${item.price.toFixed(2)}</span>
                            </div>
                        `).join('')}
                        
                        <div class="d-flex justify-content-between mt-2 pt-2 border-top">
                            <span>Subtotal:</span>
                            <span>$${currentCheckoutData.subtotal.toFixed(2)}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Descuento:</span>
                            <span>-$${currentCheckoutData.discount.toFixed(2)}</span>
                        </div>
                        <div class="d-flex justify-content-between mt-3 pt-3 border-top">
                            <strong>Total:</strong>
                            <strong class="text-gradient">$${currentCheckoutData.total.toFixed(2)}</strong>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6>Informaci√≥n:</h6>
                    <div class="small-muted">
                        <div>Email: ${currentCheckoutData.email}</div>
                        <div>M√©todo: ${currentCheckoutData.paymentMethod}</div>
                        <div>Orden: ${currentCheckoutData.orderId}</div>
                    </div>
                </div>
                
                <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="termsCheck">
                    <label class="form-check-label small-muted" for="termsCheck">
                        Acepto los <a href="#" onclick="showTerms()">t√©rminos y condiciones</a>
                    </label>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="processPayment()" id="processPaymentBtn">
                        <i class="fas fa-lock me-2"></i>Confirmar y Pagar
                    </button>
                    <button class="btn btn-outline" onclick="showPaymentMethods()">
                        Cambiar M√©todo
                    </button>
                </div>
            `;
        }

        async function processPayment() {
            const termsChecked = document.getElementById('termsCheck');
            if (!termsChecked || !termsChecked.checked) {
                toastr.error('Debes aceptar los t√©rminos y condiciones');
                return;
            }
            
            const btn = document.getElementById('processPaymentBtn');
            if (!btn) return;
            
            btn.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div> Procesando...';
            btn.disabled = true;
            
            try {
                let paymentResult;
                
                switch (currentCheckoutData.paymentMethod) {
                    case 'paypal':
                        paymentResult = await paymentSystem.processPayPal(currentCheckoutData);
                        break;
                    case 'mercadopago':
                        paymentResult = await paymentSystem.processMercadoPago(currentCheckoutData);
                        break;
                    case 'transfer':
                        paymentResult = paymentSystem.processTransfer(currentCheckoutData);
                        break;
                    case 'crypto':
                        paymentResult = paymentSystem.processCrypto(currentCheckoutData);
                        break;
                    default:
                        throw new Error('M√©todo de pago no v√°lido');
                }
                
                if (paymentResult.success) {
                    await completeOrder(paymentResult);
                } else {
                    throw new Error('Pago fallido');
                }
            } catch (error) {
                console.error('Error en el pago:', error);
                toastr.error('Error en el procesamiento del pago: ' + error.message);
                btn.innerHTML = '<i class="fas fa-lock me-2"></i>Confirmar y Pagar';
                btn.disabled = false;
            }
        }

        async function completeOrder(paymentResult) {
            // Generar token
            const token = tokenSystem.generateToken(currentCheckoutData);
            
            // Preparar datos de la orden
            const orderData = {
                ...currentCheckoutData,
                status: paymentResult.status === 'pending' ? 'pending' : 'completed',
                paymentResult: paymentResult,
                token: token,
                completedAt: new Date().toISOString()
            };
            
            // Guardar orden
            db.saveOrder(orderData);
            
            // Guardar token
            tokenSystem.saveToken(token, currentCheckoutData.email, currentCheckoutData.orderId);
            
            // Guardar usuario si no existe
            const users = db.getUsers();
            if (!users.find(u => u.email === currentCheckoutData.email)) {
                db.saveUser({
                    email: currentCheckoutData.email,
                    name: currentCheckoutData.name,
                    country: currentCheckoutData.country,
                    joinedAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    status: 'active'
                });
            }
            
            // Enviar email de confirmaci√≥n
            if (db.getSettings().autoEmails) {
                await emailSystem.sendConfirmation(
                    currentCheckoutData.email,
                    token,
                    currentCheckoutData.orderId,
                    currentCheckoutData
                );
            }
            
            // Limpiar carrito
            cart.items = [];
            cart.save();
            
            // Mostrar confirmaci√≥n
            showOrderConfirmation(token, orderData);
            
            toastr.success('¬°Compra completada exitosamente!');
        }

        function showOrderConfirmation(token, orderData) {
            const content = document.getElementById('paymentModalContent');
            if (!content) return;
            
            content.innerHTML = `
                <div class="text-center">
                    <div class="mb-4">
                        <i class="fas fa-check-circle fa-4x text-success"></i>
                    </div>
                    
                    <h4 class="mb-3">¬°Pago Exitoso!</h4>
                    <p class="small-muted mb-4">Tu pedido ha sido procesado correctamente.</p>
                    
                    <div class="alert alert-dark mb-4">
                        <i class="fas fa-receipt me-2"></i>
                        <strong>Orden #:</strong> ${orderData.orderId}
                    </div>
                    
                    <div class="token-display mb-4">
                        ${token}
                    </div>
                    
                    <div class="alert alert-success mb-4">
                        <i class="fas fa-envelope me-2"></i>
                        ${db.getSettings().autoEmails 
                            ? `El token ha sido enviado a: <strong>${orderData.email}</strong>`
                            : `Guarda tu token. No se envi√≥ email (configuraci√≥n desactivada)`
                        }
                    </div>
                    
                    <div class="d-grid gap-2 mb-3">
                        <button class="btn btn-primary" onclick="downloadInvoice('${orderData.orderId}')">
                            <i class="fas fa-file-invoice me-2"></i>Descargar Factura
                        </button>
                        <button class="btn btn-outline" onclick="activateToken('${token}')">
                            <i class="fas fa-rocket me-2"></i>Activar Token Ahora
                        </button>
                    </div>
                    
                    <button class="btn btn-outline w-100" onclick="closePaymentModal()">
                        Cerrar
                    </button>
                </div>
            `;
        }

        function closePaymentModal() {
            const modal = document.getElementById('paymentModal');
            if (modal) {
                modal.style.display = 'none';
            }
            currentCheckoutData = null;
        }

        // Panel de usuario
        function accessUserPanel() {
            const tokenInput = document.getElementById('userToken');
            const token = tokenInput ? tokenInput.value : '';
            
            if (!token) {
                toastr.warning('Ingresa un token');
                return;
            }
            
            const tokenData = db.validateToken(token);
            
            if (!tokenData) {
                toastr.error('Token inv√°lido o expirado');
                return;
            }
            
            showUserPanel(token, tokenData);
        }

        function showUserPanel(token, tokenData) {
            const modal = document.getElementById('userPanelModal');
            const content = document.getElementById('userPanelContent');
            
            if (!modal || !content) return;
            
            // Obtener √≥rdenes del usuario
            const orders = db.getOrders().filter(o => o.email === tokenData.email);
            // Obtener archivos disponibles
            const files = db.getFiles();
            // Obtener productos
            const products = db.getProducts();
            
            content.innerHTML = `
                <div class="mb-4">
                    <h5><i class="fas fa-key me-2"></i>Tu Token</h5>
                    <div class="token-display">
                        ${token}
                    </div>
                    <p class="small-muted mt-2">
                        <i class="fas fa-calendar me-1"></i>
                        V√°lido hasta: ${new Date(tokenData.expires).toLocaleDateString('es-ES')}
                    </p>
                </div>
                
                <div class="mb-4">
                    <h5><i class="fas fa-download me-2"></i>Tus Descargas</h5>
                    ${files.length === 0 ? 
                        '<p class="text-muted">No hay archivos disponibles para descargar.</p>' : 
                        files.map(file => `
                            <div class="download-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">${file.name}</h6>
                                        <p class="small-muted mb-0">
                                            ${(file.size / 1024 / 1024).toFixed(2)} MB ‚Ä¢ 
                                            ${file.downloads || 0} descargas
                                        </p>
                                    </div>
                                    <button class="download-btn" onclick="downloadFile('${file.id}', '${token}')">
                                        <i class="fas fa-download me-1"></i> Descargar
                                    </button>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
                
                <div class="mb-4">
                    <h5><i class="fas fa-history me-2"></i>Tus √ìrdenes</h5>
                    ${orders.length === 0 ? 
                        '<p class="text-muted">No tienes √≥rdenes registradas.</p>' : 
                        orders.slice(0, 5).map(order => `
                            <div class="alert alert-dark mb-2">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>${order.orderId}</strong>
                                        <br>
                                        <small>${new Date(order.date).toLocaleDateString('es-ES')}</small>
                                    </div>
                                    <div class="text-end">
                                        <strong>$${order.total.toFixed(2)}</strong>
                                        <br>
                                        <span class="badge ${order.status === 'completed' ? 'bg-success' : 'bg-warning'}">
                                            ${order.status}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
                
                <div class="mt-4">
                    <button class="btn btn-outline w-100" onclick="downloadInvoice('${orders[0]?.orderId || ''}')">
                        <i class="fas fa-file-pdf me-2"></i>Descargar Factura
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeUserPanel() {
            const modal = document.getElementById('userPanelModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Funciones de descarga
        function downloadFile(fileId, token = null) {
            fileSystem.downloadFile(fileId, token);
        }

        function downloadDemo(productId) {
            const files = fileSystem.getProductFiles(productId);
            if (files.length > 0) {
                // Descargar el primer archivo como demo
                fileSystem.downloadFile(files[0].id);
            } else {
                toastr.info('Demo no disponible por el momento');
            }
        }

        function downloadInvoice(orderId) {
            const orders = db.getOrders();
            const order = orders.find(o => o.orderId === orderId || o.id === orderId);
            
            if (!order) {
                toastr.error('Orden no encontrada');
                return;
            }
            
            // Generar factura HTML
            const invoiceHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Factura ${order.orderId || order.id} - OptiM Shop</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        .invoice { max-width: 800px; margin: 0 auto; }
                        .header { text-align: center; margin-bottom: 40px; }
                        .details { margin: 30px 0; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background: #f5f5f5; }
                        .total { font-weight: bold; font-size: 1.2em; }
                        .footer { margin-top: 50px; text-align: center; color: #666; }
                        .token { font-family: monospace; background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; }
                    </style>
                </head>
                <body>
                    <div class="invoice">
                        <div class="header">
                            <h1>OptiM Shop</h1>
                            <h2>Factura #${order.orderId || order.id}</h2>
                            <p>Fecha: ${new Date(order.date).toLocaleDateString('es-ES')}</p>
                        </div>
                        
                        <div class="details">
                            <p><strong>Cliente:</strong> ${order.name || 'No especificado'}</p>
                            <p><strong>Email:</strong> ${order.email}</p>
                            <p><strong>M√©todo de pago:</strong> ${order.paymentMethod}</p>
                            <p><strong>Estado:</strong> ${order.status}</p>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Precio</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td>$${item.price.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td><strong>Subtotal</strong></td>
                                    <td>$${order.subtotal.toFixed(2)}</td>
                                </tr>
                                <tr>
                                    <td><strong>Descuento</strong></td>
                                    <td>-$${order.discount.toFixed(2)}</td>
                                </tr>
                                <tr class="total">
                                    <td><strong>Total</strong></td>
                                    <td>$${order.total.toFixed(2)}</td>
                                </tr>
                            </tfoot>
                        </table>
                        
                        ${order.token ? `
                        <div class="details">
                            <h3>Token de Activaci√≥n</h3>
                            <div class="token">${order.token}</div>
                            <p><small>Usa este token para acceder a tus productos en el Panel de Usuario.</small></p>
                        </div>
                        ` : ''}
                        
                        <div class="footer">
                            <p>Gracias por tu compra en OptiM Shop</p>
                            <p>Contacto: ${CONFIG.adminEmail} | ${CONFIG.adminPhone}</p>
                            <p>Esta factura es v√°lida como comprobante de pago.</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            // Crear y descargar archivo
            const blob = new Blob([invoiceHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `factura-${order.orderId || order.id}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            toastr.success('Factura descargada');
        }

        // Funciones varias
        function selectPlan(planId) {
            if (planId === 'free') {
                toastr.info('Puedes descargar los programas b√°sicos gratuitamente desde el Panel de Usuario');
            } else {
                addToCart(planId);
            }
        }

        function selectPayment(method) {
            toastr.info(`Redirigiendo a ${method}...`);
            // En producci√≥n aqu√≠ ir√≠a la integraci√≥n real
        }

        function loadStats() {
            const stats = db.getStats();
            
            const totalUsersEl = document.getElementById('totalUsers');
            const totalSalesEl = document.getElementById('totalSales');
            const satisfactionRateEl = document.getElementById('satisfactionRate');
            
            if (totalUsersEl) totalUsersEl.textContent = (stats.activeUsers || 1250) + '+';
            if (totalSalesEl) totalSalesEl.textContent = (stats.totalOrders || 850) + '+';
            if (satisfactionRateEl) satisfactionRateEl.textContent = '99%';
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const products = document.querySelectorAll('#productsContainer .col-md-6, #productsContainer .col-lg-4');
                
                products.forEach(product => {
                    const text = product.textContent.toLowerCase();
                    product.style.display = text.includes(query) ? 'block' : 'none';
                });
            });
        }

        function activateToken(token) {
            localStorage.setItem('optim_active_token', token);
            toastr.success('Token activado correctamente');
            closePaymentModal();
            accessUserPanel();
        }

        function generateInvoice() {
            const orders = db.getOrders();
            if (orders.length === 0) {
                toastr.info('No tienes √≥rdenes para generar factura');
                return;
            }
            
            // Usar la √∫ltima orden
            const lastOrder = orders[orders.length - 1];
            downloadInvoice(lastOrder.orderId || lastOrder.id);
        }

        // Funciones de informaci√≥n
        function showTerms() {
            alert('T√âRMINOS Y CONDICIONES - OptiM Shop\n\n' +
                  '1. Los tokens son personales e intransferibles.\n' +
                  '2. Garant√≠a de 30 d√≠as en todos los productos.\n' +
                  '3. Soporte disponible seg√∫n plan contratado.\n' +
                  '4. Los precios pueden cambiar sin previo aviso.\n' +
                  '5. El uso indebido puede resultar en revocaci√≥n del token.\n' +
                  '6. Nos reservamos el derecho de rechazar ventas.\n' +
                  '7. Los archivos digitales no tienen devoluci√≥n una vez descargados.');
        }

        function showPrivacy() {
            alert('POL√çTICA DE PRIVACIDAD\n\n' +
                  '1. Solo recopilamos informaci√≥n necesaria para el servicio.\n' +
                  '2. No compartimos datos con terceros sin consentimiento.\n' +
                  '3. Los pagos se procesan de forma segura.\n' +
                  '4. Puedes solicitar eliminaci√≥n de datos en cualquier momento.\n' +
                  '5. Usamos cookies para mejorar la experiencia.\n' +
                  '6. Los datos se almacenan de forma segura en tu navegador.');
        }

        function showRefund() {
            alert('POL√çTICA DE REEMBOLSOS\n\n' +
                  '1. 30 d√≠as de garant√≠a en todos los productos.\n' +
                  '2. Reembolso 100% si no est√°s satisfecho.\n' +
                  '3. Proceso simple: email a matias.taibo2023@gmail.com\n' +
                  '4. Reembolso en 7-10 d√≠as h√°biles.\n' +
                  '5. Los archivos descargados no son reembolsables.\n' +
                  '6. Los tokens activados requieren revisi√≥n caso por caso.');
        }

        function showCookiePolicy() {
            alert('POL√çTICA DE COOKIES\n\n' +
                  'Usamos cookies para:\n' +
                  '1. Recordar tu carrito de compras\n' +
                  '2. Mejorar la experiencia de usuario\n' +
                  '3. Analizar uso del sitio (localmente)\n' +
                  '4. Recordar tu token de acceso\n\n' +
                  'Puedes limpiar todas las cookies desde Configuraci√≥n > Limpiar Datos.');
        }

        // ============================================
        // INICIALIZACI√ìN AL CARGAR LA P√ÅGINA
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            init();
            
            // Verificar si hay un token activo
            const activeToken = localStorage.getItem('optim_active_token');
            if (activeToken && db.validateToken(activeToken)) {
                console.log('Token activo detectado:', activeToken);
            }
            
            // Configurar toastr
            toastr.options = {
                "closeButton": true,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "timeOut": "5000"
            };
        });

        // Exportar funciones al √°mbito global
        window.addToCart = addToCart;
        window.removeFromCart = removeFromCart;
        window.toggleCart = toggleCart;
        window.clearCart = clearCart;
        window.checkout = checkout;
        window.selectPaymentOption = selectPaymentOption;
        window.processPayment = processPayment;
        window.closePaymentModal = closePaymentModal;
        window.downloadInvoice = downloadInvoice;
        window.downloadDemo = downloadDemo;
        window.downloadFile = downloadFile;
        window.generateInvoice = generateInvoice;
        window.accessUserPanel = accessUserPanel;
        window.closeUserPanel = closeUserPanel;
        window.selectPlan = selectPlan;
        window.selectPayment = selectPayment;
        window.showTerms = showTerms;
        window.showPrivacy = showPrivacy;
        window.showRefund = showRefund;
        window.showCookiePolicy = showCookiePolicy;
        window.activateToken = activateToken;
        window.filterProducts = filterProducts;
        
        // Hacer la base de datos disponible para el panel de administraci√≥n
        window.getDatabase = () => db;
        window.getFileSystem = () => fileSystem;
        window.getTokenSystem = () => tokenSystem;
        window.getEmailSystem = () => emailSystem;
        window.getPaymentSystem = () => paymentSystem;
        window.getCart = () => cart;

    </script>
</body>
</html>


